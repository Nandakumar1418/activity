<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Custom Journey Builder Activity - Twilio SMS</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="js/require.js"></script>
    <script type="text/javascript">
        (function() {
            var config = {
                baseUrl: 'js'
            };

            var dependencies = [
                'customActivity'
            ];

            require(config, dependencies); 
        })();
    </script>
    <script type="text/javascript">
        $(document).ready(function() {
            function updatePreview() {
                var messageBody = $('#messageBody').val();
                $('#messagePreview').text(messageBody);
            }

            $('#insertFieldButton').click(function() {
                var selectedField = $('#personalizationField').val();
                var messageBody = $('#messageBody');
                var cursorPosition = messageBody.prop("selectionStart");
                var textBeforeCursor = messageBody.val().substring(0, cursorPosition);
                var textAfterCursor = messageBody.val().substring(cursorPosition);

                messageBody.val(textBeforeCursor + selectedField + textAfterCursor);
                updatePreview();
            });

            $('#messageBody').on('input', function() {
                updatePreview();
            });

            updatePreview(); // Initial call to set the preview when the page loads
        });
    </script>

    <!-- Styles -->
    <style type="text/css">
        html, body {
            height: 100%;
            margin: 0;
            overflow: hidden; /* Prevent scrolling */
        }
        #step1 h2{
            padding: 0 20px;
        }
        #step1 {
            display: block;
        }
        #container {
            display: flex;
            justify-content: space-between; /* Space between form and preview */
            /* align-items: center; */
            height: 90vh; /* Full viewport height */
            overflow: hidden; /* Prevent scrolling */
            padding: 10px; /* Adjust padding as needed */
        }
        #formSection {
            flex: 1;
            max-width: 100%;
            padding: 0 10px;
            box-sizing: border-box;
        }
        #phoneContainer {
            width: 33.33%; /* One-third of the window width */
            max-width: 360px; /* Maximum width of the phone container */
            height: 100%; /* Fit within viewport height */
            /*border: 16px solid #333;
            border-radius: 36px; */
            /*padding: 20px;*/
            background: black;
            position: relative;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden; /* Prevent scrolling */
        }
        #phoneHeader{
            width: 100%;
            height: 15%;
            background-color : blue;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        #phoneScreen {
            width: 100%;
            height: 85%;
            background: #f8f9fa;
/*             border-radius: 20px; */
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: flex-end; /* Align message to bottom */
            padding: 10px;
            box-sizing: border-box; /* Ensure padding does not cause overflow */
        }

        #messagePreview {
            background-color: #fff;
            border-radius: 15px;
            padding: 10px 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            max-width: 100%;
            word-wrap: break-word;
            align-self: flex-start; /* Align message bubble to the left */
            margin-bottom: 10px;
            position: relative;
            white-space: pre-wrap; /* Preserve whitespace and line breaks */
        }
        #messagePreview::before {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 15px;
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid #fff;
        }
/*         #phoneContainer::before {
            content: "";
            position: absolute;
            top: 20px;
            left: calc(50% - 15px);
            width: 30px;
            height: 5px;
            background: #333;
            border-radius: 10px;
        } */
    </style>

</head>
<body>
<div id="step1" class="step">
    <h2>Create SMS Content:</h2>
    <div id="container">
        <div id="formSection">
            <div class="form-group">
                <div><label for="messageBody">Create message body:</label></div>
                <textarea class="form-control" id="messageBody" rows="4"></textarea>
            </div>
            <div class="form-group">
                <label for="personalizationField">Insert Personalization Field:</label>
                <select class="form-control" id="personalizationField">
                    <option value="{{Contact.Attribute.Customers.FirstName}}">First Name</option>
                    <option value="{{Contact.Attribute.Customers.LastName}}">Last Name</option>
                    <option value="{{Contact.Attribute.Customers.EmailAddress}}">Email Address</option>
                </select>
            </div>
            <button class="btn btn-secondary" id="insertFieldButton">Insert Field</button>  
        </div>
        <div id="phoneContainer">
            <div id="phoneHeader">
                <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100" viewBox="0,0,256,256">
<g transform="translate(6.4,6.4) scale(0.95,0.95)"><g fill="none" fill-rule="nonzero" stroke="#000000" stroke-width="42.66667" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M128,235.04141c-59.11734,0 -107.04141,-47.92407 -107.04141,-107.04141v0c0,-59.11734 47.92407,-107.04141 107.04141,-107.04141v0c59.11734,0 107.04141,47.92407 107.04141,107.04141v0c0,59.11734 -47.92407,107.04141 -107.04141,107.04141z" id="shape"></path></g><g fill="#000000" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><g transform="scale(10.66667,10.66667)"><path d="M18,2h-12c-1.105,0 -2,0.895 -2,2v16c0,1.105 0.895,2 2,2h12c1.105,0 2,-0.895 2,-2v-16c0,-1.105 -0.895,-2 -2,-2zM12,6c1.7,0 3,1.3 3,3c0,1.7 -1.3,3 -3,3c-1.7,0 -3,-1.3 -3,-3c0,-1.7 1.3,-3 3,-3zM16.333,18h-8.666c-0.369,0 -0.667,-0.298 -0.667,-0.667v-0.333c0,-1.571 2.512,-3 5,-3c2.488,0 5,1.429 5,3v0.333c0,0.369 -0.298,0.667 -0.667,0.667z"></path></g></g></g>
</svg>
<p>[FROM NAME]</p>
            </div>
            <div id="phoneScreen">
                <div id="messagePreview"></div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
